<%- include('partials/header') %>

<div class="main-card">
    <h2>Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ø¯ÙˆØ§Ø¡ Ø¬Ø¯ÙŠØ¯</h2>
    <p>ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ© Ø¨Ø¯Ù‚Ø© Ù„Ø¶Ù…Ø§Ù† ÙˆØµÙˆÙ„ Ø§Ù„Ø¯ÙˆØ§Ø¡ Ø¥Ù„ÙŠÙƒÙ….</p>
    
    <% if (locals.errorMsg) { %>
        <div style="background: #fff1f2; color: #e11d48; padding: 20px; border-radius: 20px; border: 1px solid #fda4af; text-align: center; margin-bottom: 25px; animation: shake 0.5s;">
            <p style="font-weight: 800; margin-bottom: 10px;">ğŸ›‘ ØªÙ†Ø¨ÙŠÙ‡ Ù†Ø¸Ø§Ù… Ù…ÙØ¹ÙŠÙ†Ùƒ</p>
            <p style="font-size: 14px; margin-bottom: 15px;"><%= errorMsg %></p>
            <a href="/track-request" class="btn-primary" style="padding: 10px 20px; font-size: 14px; display: inline-block; width: auto; margin-top: 0;">ØªØªØ¨Ø¹ Ø·Ù„Ø¨Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ</a>
        </div>
        
        <style>
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                25% { transform: translateX(-5px); }
                75% { transform: translateX(5px); }
            }
        </style>
    <% } %>

    <form id="requestForm" action="/create-request" method="POST">
        <label for="fullName">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
        <input type="text" id="fullName" name="fullName" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯" required>

        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
            <div style="flex: 1; min-width: 200px;">
                <label for="medicalFile">Ø±Ù‚Ù… Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø·Ø¨ÙŠ</label>
                <input type="text" id="medicalFile" name="medicalFile" placeholder="12345" required>
            </div>
            
            <div style="flex: 1; min-width: 200px;">
                <label for="nationalId">Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©</label>
                <input type="text" id="nationalId" name="nationalId" maxlength="10" placeholder="10 Ø£Ø±Ù‚Ø§Ù…" required>
            </div>
        </div>

        <label for="phone">Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</label>
        <input type="text" id="phone" name="phone" placeholder="05xxxxxxxx" required>

        <div style="margin: 30px 0; padding: 20px; border: 1px dashed #cbd5e1; border-radius: 20px; background: rgba(248, 250, 252, 0.5);">
            <h3 style="color: var(--blue-900); font-size: 18px; margin-top: 0; margin-bottom: 15px;">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙˆØ·Ù†ÙŠ</h3>
            
            <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 10px;">
                <div style="flex: 1; min-width: 120px;"><label style="font-size: 13px;">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø®ØªØµØ±</label><input type="text" name="shortAddress" placeholder="JDAA0000" required></div>
                <div style="flex: 1; min-width: 120px;"><label style="font-size: 13px;">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label><input type="text" name="city" placeholder="Ø¬Ø¯Ø©" required></div>
                <div style="flex: 1; min-width: 120px;"><label style="font-size: 13px;">Ø§Ù„Ø­ÙŠ</label><input type="text" name="district" placeholder="Ø§Ù„Ø±ÙˆØ¶Ø©" required></div>
            </div>

            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <div style="flex: 1; min-width: 120px;"><label style="font-size: 13px;">Ø§Ù„Ø´Ø§Ø±Ø¹</label><input type="text" name="street" placeholder="Ø§Ù„Ù…Ù„Ùƒ ÙÙ‡Ø¯" required></div>
                <div style="flex: 1; min-width: 120px;"><label style="font-size: 13px;">Ø±Ù‚Ù… Ø§Ù„Ù…Ø¨Ù†Ù‰</label><input type="text" name="buildingNum" placeholder="1234" required></div>
                <div style="flex: 1; min-width: 120px;"><label style="font-size: 13px;">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙØ±Ø¹ÙŠ</label><input type="text" name="extraNum" placeholder="5678"></div>
                <div style="flex: 1; min-width: 120px;"><label style="font-size: 13px;">Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø¨Ø±ÙŠØ¯ÙŠ</label><input type="text" name="postalCode" placeholder="12345"></div>
            </div>
        </div>

        <div style="margin-bottom: 25px;">
            <label for="patientNotes" style="display: block; margin-bottom: 8px;">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
            <textarea id="patientNotes" name="patientNotes" rows="3" placeholder="Ø§ÙƒØªØ¨ Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª ØªÙˆØ¯ Ø¥Ø¨Ù„Ø§Øº Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ© Ø¨Ù‡Ø§..." style="width: 100%; padding: 12px; border: 1px solid #cbd5e1; border-radius: 12px; font-family: 'Tajawal', sans-serif; resize: vertical;"></textarea>
        </div>

        <div id="validationAlert" style="display: none; background: #fff1f2; color: #e11d48; padding: 12px; border-radius: 12px; border: 1px solid #fda4af; margin-bottom: 15px; text-align: center; font-weight: bold;"></div>

        <button type="submit" class="btn-primary" style="margin-top: 10px;">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†</button>
    </form>
</div>

<script>
    const form = document.getElementById("requestForm");
    const validationAlert = document.getElementById("validationAlert");

    form.addEventListener("submit", function(e) {
        e.preventDefault();
        validationAlert.style.display = "none";

        const nid = document.getElementById("nationalId").value.trim();
        const ph = document.getElementById("phone").value.trim();

        if (!/^\d{10}$/.test(nid)) {
            validationAlert.textContent = "âš ï¸ Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ© ÙŠØ¬Ø¨ Ø£Ù† ÙŠØªÙƒÙˆÙ† Ù…Ù† 10 Ø£Ø±Ù‚Ø§Ù…";
            validationAlert.style.display = "block";
            return;
        }

        if (!/^05\d{8}$/.test(ph)) {
            validationAlert.textContent = "âš ï¸ Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ø¯Ø£ Ø¨Ù€ 05 ÙˆÙŠØªÙƒÙˆÙ† Ù…Ù† 10 Ø£Ø±Ù‚Ø§Ù…";
            validationAlert.style.display = "block";
            return;
        }

        form.submit();
    });
</script>

<%- include('partials/footer') %>